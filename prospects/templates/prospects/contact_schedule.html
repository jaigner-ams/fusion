{% extends 'prospects/base_prospects.html' %}

{% block title %}{{ title }} - AMS Fusion Prospects{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Contact Schedule</h1>
    <a href="{% url 'prospects:prospect_list' %}" class="btn btn-secondary">Back to List</a>
</div>

<!-- Date Picker -->
<div class="card mb-4">
    <h5 class="mb-3">Select Date</h5>
    <form method="get" class="row g-3 align-items-end">
        <div class="col-md-4">
            <label for="date" class="form-label">Contact Date</label>
            <input type="date" class="form-control" id="date" name="date" value="{{ selected_date|date:'Y-m-d' }}">
        </div>
        <div class="col-md-4">
            <button type="submit" class="btn btn-primary">Show Contacts</button>
            <a href="{% url 'prospects:contact_schedule' %}" class="btn btn-secondary">Today</a>
        </div>
    </form>
</div>

<!-- Contacts for Selected Date -->
<div class="card">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="mb-0">Contacts for {{ selected_date|date:"l, F d, Y" }}</h4>
        <div class="d-flex gap-2 align-items-center">
            <span class="badge bg-info fs-6">{{ prospects.count }} contact{{ prospects.count|pluralize }}</span>
            {% if prospects %}
                <a href="{% url 'prospects:export_csv' %}?contact_date={{ selected_date|date:'Y-m-d' }}" class="btn btn-success btn-sm">Export CSV</a>
            {% endif %}
        </div>
    </div>

    {% if prospects %}
        <div class="table-responsive">
            <table id="contactsTable" class="table table-striped table-hover mb-0">
                <thead>
                    <tr>
                        <th>Lab Name</th>
                        <th>Contact Person</th>
                        <th>Phone</th>
                        <th>Email</th>
                        <th>Location</th>
                        <th>Status</th>
                        <th class="no-sort">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for prospect in prospects %}
                        <tr>
                            <td>
                                <a href="{% url 'prospects:prospect_detail' prospect.pk %}" class="text-theme text-decoration-none">
                                    <strong>{{ prospect.lab_name }}</strong>
                                </a>
                            </td>
                            <td>{{ prospect.person_name }}</td>
                            <td>{{ prospect.phone }}</td>
                            <td>{{ prospect.email }}</td>
                            <td>{{ prospect.city }}{% if prospect.city and prospect.state %}, {% endif %}{{ prospect.state }}</td>
                            <td>
                                {% if prospect.status == 'prospect' %}
                                    <span class="badge badge-prospect">Fusion Prospect</span>
                                {% elif prospect.status == 'member' %}
                                    <span class="badge badge-member">Fusion Member</span>
                                {% elif prospect.status == 'declined' %}
                                    <span class="badge badge-declined">Fusion Declined</span>
                                {% elif prospect.status == 'corporate' %}
                                    <span class="badge badge-corporate">Corporate Lab</span>
                                {% endif %}
                            </td>
                            <td>
                                <a href="{% url 'prospects:prospect_detail' prospect.pk %}" class="btn btn-sm btn-outline-info">View</a>
                                <a href="{% url 'prospects:prospect_edit' prospect.pk %}" class="btn btn-sm btn-outline-warning">Edit</a>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% else %}
        <div class="text-center py-5">
            <h4 class="text-muted">No contacts scheduled</h4>
            <p class="text-muted">
                No prospects are scheduled for contact on {{ selected_date|date:"F d, Y" }}.
            </p>
        </div>
    {% endif %}
</div>

<!-- Quick Links to Other Dates -->
<div class="card mt-4">
    <h5 class="mb-3">Quick Navigation</h5>
    <div class="d-flex gap-2 flex-wrap">
        {% load tz %}
        {% now "Y-m-d" as today %}
        <a href="{% url 'prospects:contact_schedule' %}?date={{ today }}" class="btn btn-outline-info btn-sm">Today</a>
        <!-- Add more quick links as needed -->
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    $('#contactsTable').DataTable({
        pageLength: 25,
        lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
        order: [[0, 'asc']],  // Sort by Lab Name by default
        columnDefs: [
            { orderable: false, targets: 6 }  // Disable sorting on Actions column
        ],
        language: {
            search: "Search:",
            lengthMenu: "Show _MENU_ entries",
            info: "Showing _START_ to _END_ of _TOTAL_ contacts",
            infoEmpty: "No contacts found",
            infoFiltered: "(filtered from _MAX_ total)",
            paginate: {
                first: "First",
                last: "Last",
                next: "Next",
                previous: "Previous"
            }
        }
    });
});
</script>
{% endblock %}
